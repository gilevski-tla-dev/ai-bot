# üóÑÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üéØ –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢–µ–ø–µ—Ä—å –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ PostgreSQL**, –∞ –Ω–µ —á–µ—Ä–µ–∑ –∫–æ–¥ –±–æ—Ç–∞.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```
db-init/
‚îú‚îÄ‚îÄ 01-init.sql          # SQL —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
‚îî‚îÄ‚îÄ Dockerfile           # Dockerfile –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. **PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**

- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ PostgreSQL –∏—â–µ—Ç SQL —Ñ–∞–π–ª—ã –≤ `/docker-entrypoint-initdb.d/`
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã

### 2. **Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

```yaml
postgres:
  image: postgres:15-alpine
  volumes:
    - postgres-data:/var/lib/postgresql/data
    - ./db-init:/docker-entrypoint-initdb.d # ‚Üê SQL —Å–∫—Ä–∏–ø—Ç—ã
```

### 3. **SQL —Å–∫—Ä–∏–ø—Ç (01-init.sql)**

```sql
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    user_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
CREATE INDEX IF NOT EXISTS idx_users_user_id ON users(user_id);
CREATE INDEX IF NOT EXISTS idx_users_created_at ON users(created_at);
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üöÄ **–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞**

1. **PostgreSQL** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã** –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. **Telegram Bot** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≥–æ—Ç–æ–≤–æ–π –ë–î
4. **pgAdmin** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≥–æ—Ç–æ–≤–æ–π –ë–î

### üîß **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**

- –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è **–¥–æ** –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
- –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

### üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

- –ë–æ—Ç –Ω–µ —Ç—Ä–∞—Ç–∏—Ç –≤—Ä–µ–º—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å—Ä–∞–∑—É

### üõ†Ô∏è **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**

- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
- –û—Ç–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ë–î –æ—Ç –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞

```mermaid
graph TD
    A[Docker Compose Start] --> B[PostgreSQL Container]
    B --> C[Check /docker-entrypoint-initdb.d/]
    C --> D[Execute 01-init.sql]
    D --> E[Create users table + indexes]
    E --> F[PostgreSQL Ready]
    F --> G[Telegram Bot Start]
    F --> H[pgAdmin Start]
    G --> I[Bot connects to ready DB]
    H --> J[pgAdmin connects to ready DB]
```

## üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü

### 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π SQL —Ñ–∞–π–ª

```bash
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –Ω–æ–º–µ—Ä–æ–º –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ
touch db-init/02-new-table.sql
```

### 2. –î–æ–±–∞–≤–∏—Ç—å SQL –∫–æ–¥

```sql
-- db-init/02-new-table.sql
CREATE TABLE IF NOT EXISTS messages (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(user_id),
    message_text TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IF NOT EXISTS idx_messages_user_id ON messages(user_id);
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
docker compose down -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ (–≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ SQL —Ñ–∞–π–ª—ã)
docker compose up -d
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL
docker compose exec postgres psql -U postgres -d telegram_bot

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
\dt

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
\d users

# –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
\di
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ pgAdmin

1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:5050
2. –í–æ–π—Ç–∏: admin@admin.com / admin
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É `postgres`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ `telegram_bot` ‚Üí `Schemas` ‚Üí `public` ‚Üí `Tables`

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –Ω–æ–º–µ—Ä–æ–º
echo "03-add-user-settings.sql" > db-init/03-add-user-settings.sql
```

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –£–¥–∞–ª–∏—Ç—å volume —Å –¥–∞–Ω–Ω—ã–º–∏
docker compose down -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ (–≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏)
docker compose up -d
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ SQL —Ñ–∞–π–ª—ã
ls -la db-init/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
ls db-init/*.sql | sort
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### ‚ö†Ô∏è **–ü–æ—Ä—è–¥–æ–∫ —Ñ–∞–π–ª–æ–≤**

- –§–∞–π–ª—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ **–∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã: `01-`, `02-`, `03-`
- –ü—Ä–∏–º–µ—Ä: `01-init.sql`, `02-users.sql`, `03-indexes.sql`

### ‚ö†Ô∏è **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**

- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CREATE TABLE IF NOT EXISTS`
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CREATE INDEX IF NOT EXISTS`
- –°–∫—Ä–∏–ø—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### ‚ö†Ô∏è **–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**

```bash
# –û–°–¢–û–†–û–ñ–ù–û: –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
docker compose down -v
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥   | –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥                 |
| --------------------- | --------------- | ---------------------------- |
| **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü**   | –í –∫–æ–¥–µ –±–æ—Ç–∞     | –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PostgreSQL |
| **–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞**   | –ë–æ—Ç ‚Üí –ë–î        | –ë–î ‚Üí –ë–æ—Ç                     |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**        | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–¥–∞ | –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–¥–∞           |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π** | –í –∫–æ–¥–µ Go       | –í SQL —Ñ–∞–π–ª–∞—Ö                 |
| **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**   | –°–ª–æ–∂–Ω–æ          | –ü—Ä–æ—Å—Ç–æ (—Ñ–∞–π–ª—ã)               |
| **–û—Ç–∫–∞—Ç**             | –°–ª–æ–∂–Ω–æ          | –ü—Ä–æ—Å—Ç–æ                       |

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞**  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤**  
‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π –ë–î**  
‚úÖ **–ù–∞–¥–µ–∂–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤**  
‚úÖ **–õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü**
